diff -urB miniupnpd-1.8/Makefile.linux miniupnpd/Makefile.linux
--- miniupnpd-1.8/Makefile.linux	2012-03-05 23:37:13.000000000 +0300
+++ miniupnpd/Makefile.linux	2013-05-17 14:16:19.000000000 +0400
@@ -17,6 +17,7 @@
 CFLAGS += -Wextra -Wstrict-prototypes -Wdeclaration-after-statement
 #CFLAGS += -Wno-missing-field-initializers
 #CFLAGS += -ansi	# iptables headers does use typeof which is a gcc extension
+CFLAGS += $(EXTRACFLAGS)
 CC ?= gcc
 RM = rm -f
 INSTALL = install
@@ -30,7 +31,7 @@
 
 ALLOBJS = $(BASEOBJS) $(LNXOBJS) $(NETFILTEROBJS)
 
-PCFILE_FOUND := $(shell pkg-config --exists libiptc; echo $$?)
+PCFILE_FOUND := 1
 
 ifeq (${PCFILE_FOUND},0)
 
@@ -41,15 +41,7 @@
 
 else
 
-ifeq "$(wildcard /etc/gentoo-release )" ""
 LIBS ?= -liptc
-else # gentoo
-# the following is better, at least on gentoo with iptables 1.4.6
-#Â see http://miniupnp.tuxfamily.org/forum/viewtopic.php?p=1618
-# and http://miniupnp.tuxfamily.org/forum/viewtopic.php?p=2183
-LIBS ?= -lip4tc
-CFLAGS := -DIPTABLES_143 $(CFLAGS)
-endif
 
 ARCH ?= $(shell uname -m | grep -q "x86_64" && echo 64)
 ifdef IPTABLESPATH
@@ -65,9 +57,6 @@
 TEST := $(shell [ \( \( $(IPTABLESVERSION1) -ge 1 \) -a \( $(IPTABLESVERSION2) -ge 4 \) \) -a \( $(IPTABLESVERSION3) -ge 3 \) ] && echo 1 )
 ifeq ($(TEST), 1)
 CFLAGS := $(CFLAGS) -DIPTABLES_143
-# the following sucks, but works
-LIBS = $(IPTABLESPATH)/libiptc/.libs/libip4tc.o
-#LIBS = $(IPTABLESPATH)/libiptc/.libs/libiptc.a
 else # ifeq ($(TEST), 1)
 LIBS = $(IPTABLESPATH)/libiptc/libiptc.a
 endif # ifeq ($(TEST), 1)
@@ -139,7 +128,7 @@
 	sed -i -e "s/^uuid=[-0-9a-f]*/uuid=`($(STAGING_DIR_HOST)/bin/genuuid||$(STAGING_DIR_HOST)/bin/uuidgen||$(STAGING_DIR_HOST)/bin/uuid) 2>/dev/null`/" miniupnpd.conf
 endif
 
-miniupnpd:	$(BASEOBJS) $(LNXOBJS) $(NETFILTEROBJS) $(LIBS)
+miniupnpd:	$(BASEOBJS) $(LNXOBJS) $(NETFILTEROBJS)
 
 testupnpdescgen:	$(TESTUPNPDESCGENOBJS)
 
diff --git miniupnpd-1.7.20120824/linux/getroute.c miniupnpd/linux/getroute.c
--- miniupnpd-1.7.20120824/linux/getroute.c
+++ miniupnpd/linux/getroute.c
@@ -5,6 +5,8 @@
  * This software is subject to the conditions detailed
  * in the LICENCE file provided within the distribution */
 
+#ifdef UPNP_STRICT
+
 #include <stdio.h>
 #include <string.h>
 #include <unistd.h>
@@ -160,3 +162,4 @@ error:
 	return -1;
 }
 
+#endif /* UPNP_STRICT */
